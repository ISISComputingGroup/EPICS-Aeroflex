record(bo, "$(P)SIM")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
    field(ZNAM, "NO")
    field(ONAM, "YES")
    field(VAL, "$(RECSIM=0)")
}

record(bo, "$(P)DISABLE") 
{
    field(DESC, "Disable comms")
    field(UDFS, "NO_ALARM")
    field(VAL, "$(DISABLE=0)")
    field(OMSL, "supervisory")
    field(ZNAM, "COMMS ENABLED")
    field(ONAM, "COMMS DISABLED")
}

record(bi, "$(P)CMODE") {
    field(DTYP, "Soft Channel")
    field(VAL, "$(DISABLE=0)")
    field(SCAN, "Passive")
    field(INP, "$(P)DISABLE CP")
    field(ZNAM, "REMOTE")
    field(ONAM, "LOCAL")
}
alias("$(P)CMODE", "$(P)CMODE:SP:RBV") 

record(bo, "$(P)CMODE:SP") 
{
    field(DTYP, "Soft Channel")
    field(DESC, "Enable Local or Remote Mode")
    field(ZNAM, "REMOTE")
    field(ONAM, "LOCAL")
    field(UDFS, "NO_ALARM")
    field(OUT, "$(P)DISABLE PP")
	field(FLNK, "$(P)_REM.PROC")
}

# access GPIB remote disable/enable field via asyn record
record(mbbo, "$(P)_REM")
{
    field(DTYP, "Raw Soft Channel")
	field(DOL, "$(P)CMODE:SP")
	field(OMSL, "closed_loop")
    field(ZRST, "REMOTE")
    field(ONST, "LOCAL")
	field(ZRVL, "2")
	field(ONVL, "1")
	field(OUT, "$(P)ASYN.REN PP")
}

record(ai, "$(P)_CARRIER_FREQ_RAW")
{
    field(SCAN, "2 second")
    field(DESC, "Get unscaled carrier frequency")
    field(DTYP, "stream")
    field(FLNK, "$(P)CARRIER_FREQ:RBV")
    field(INP, "@aeroflex_$(DEV_TYPE).proto getCarrierFrequency $(PORT) $(ADDR=0)")
    field(EGU, "Hz")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:CARRIER_FREQ")
    field(SDIS, "$(P)DISABLE")
}

record(calc, "$(P)CARRIER_FREQ:RBV")
{
    field(DESC, "Scaled carrier frequency")
    field(INPA, "$(P)_CARRIER_FREQ_RAW")
    field(PREC, 2)
    field(EGU, "MHz")
    field(CALC, "A * (10**-6)")
}

record(ao, "$(P)CARRIER_FREQ:SP")
{
    field(DESC, "Carrier frequency")
    field(DTYP, "stream")
    field(OUT, "@aeroflex_common.proto setCarFreq $(PORT) $(ADDR=0)")
    field(PREC, "2")
    field(EGU, "MHz") 
	
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:CARRIER_FREQ:SP")
    field(SDIS, "$(P)DISABLE")
    field(FLNK, "$(P)_CARRIER_FREQ_RAW.PROC")
}

record(mbbo, "$(P)RF_LEVEL:STATUS:SP") {
    field(DESC, "Set RF level status ON/OFF")
    field(DTYP, "stream")
    field(ZRVL, 0)
    field(ONVL, 1)
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(UDFS, "NO_ALARM")
    field(OUT, "@aeroflex_common.proto setRFOutput $(PORT) $(ADDR=0)")
    field(FLNK, "$(P)RF_STATUS.PROC")
    field(SDIS, "$(P)DISABLE")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:RF_STATUS")
}

record(stringin, "$(P)RF_STATUS") {
    field(SCAN, "2 second")
    field(DESC, "RF status")
    field(DTYP, "stream")
    field(INP, "@aeroflex_common.proto getRFStatus $(PORT) $(ADDR=0)")
    field(SDIS, "$(P)DISABLE")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:RF_STATUS")
}

record(ai, "$(P)RF_LEVEL")
{
    field(SCAN, "2 second")
    field(DESC, "RF level")
    field(DTYP, "stream")
    field(EGU, "dBm")
    field(INP, "@aeroflex_common.proto getRFLevel $(PORT) $(ADDR=0)")
    field(PREC, "$(RF_PREC)")
    info(archive, "VAL")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:RF_LEVEL")
    field(SDIS, "$(P)DISABLE")
}

record(ao, "$(P)RF_LEVEL:SP")
{
    field(DESC, "Set RF level")
    field(DTYP, "stream")
    field(OUT, "@aeroflex_common.proto setRFLevel $(PORT) $(ADDR=0)")
    field(PREC, "$(RF_PREC)")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:RF_LEVEL:SP")
    field(SDIS, "$(P)DISABLE")
    field(FLNK, "$(P)RF_LEVEL.PROC")
}

record(stringin, "$(P)ERROR")
{
    field(SCAN, "2 second")
    field(DESC, "Error")
    field(DTYP, "stream")

    field(INP, "@aeroflex_common.proto getError $(PORT) $(ADDR=0)")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:ERROR")
    field(SDIS, "$(P)DISABLE")

    info(alarm, "AEROFLEX")
    info(interest, "HIGH")
    info(archive, "VAL")
}

record(stringin, "$(P)DEV_TYPE")
{
    field(DESC, "Dev type")
    field(UDFS, "NO_ALARM")

    field(VAL, "$(DEV_TYPE)")
    field(SDIS, "$(P)DISABLE")
}

record(ao, "$(P)RESET")
{
    field(DESC, "Reset")
    field(DTYP, "stream")
    field(OUT, "@aeroflex_common.proto reset $(PORT) $(ADDR=0)")
    field(SDIS, "$(P)DISABLE")
}

record(bo, "$(P)MOD:ENABLE:SP")
{
    field(DESC, "Modulation enable")
    field(DTYP, "stream")
	field(ZNAM, "OFF")
	field(ONAM, "ON")

    field(OUT, "@aeroflex_common.proto setModulationControl $(PORT) $(ADDR=0)")
	field(FLNK, "$(P)_MODE")
    field(SIML, "$(P)SIM")
    field(SDIS, "$(P)DISABLE")
    field(SIOL, "$(P)SIM:MOD:ENABLE")
}

record(stringin, "$(P)_MODE")
{
    field(SCAN, "2 second")
    field(DESC, "Get modulation")
    field(DTYP, "stream")

    field(INP, "@aeroflex_common.proto getModulation $(PORT) $(ADDR=0)")

    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:MODE")
    field(SDIS, "$(P)DISABLE")
    field(FLNK, "$(P)MOD:ENABLE")
}

# global modulation on/off
record(bi, "$(P)MOD:ENABLE")
{
    field(DESC, "Modulation enabled")
    field(DTYP, "stream")
	field(ZNAM, "OFF")
	field(ONAM, "ON")
    field(SIML, "$(P)SIM")
    field(SDIS, "$(P)DISABLE")
    field(SIOL, "$(P)SIM:MOD:ENABLE")

    field(INP, "@aeroflex_common.proto getModulationControl $(PORT) $(ADDR=0)")
	field(FLNK, "$(P)_MODE:CALC")
}

record(scalcout, "$(P)_MODE:CALC")
{
    field(INPA, "$(P)MOD:ENABLE")
    field(INAA, "$(P)_MODE")
	field(CALC, "A==1?AA:'DISABLED'")
    field(OUT, "$(P)MODE PP")
}

record(stringin, "$(P)MODE")
{

}

record(bi, "$(P)MOD:PULSE")
{
    field(SCAN, "2 second")
    field(DESC, "Pulse Modulation enabled")
    field(DTYP, "stream")
	field(ZNAM, "OFF")
	field(ONAM, "ON")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:MOD:PULSE")
    field(SDIS, "$(P)DISABLE")

    field(INP, "@aeroflex_common.proto getPulseModulation $(PORT) $(ADDR=0)")
}

record(bi, "$(P)MOD:PULSE:CW")
{
    field(SCAN, "2 second")
    field(DESC, "Pulse CW enabled")
    field(DTYP, "stream")
	field(ZNAM, "OFF")
	field(ONAM, "ON")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:MOD:PULSE:CW")
    field(SDIS, "$(P)DISABLE")

    field(INP, "@aeroflex_common.proto getPulseCWSupression $(PORT) $(ADDR=0)")
}

### SIMULATION RECORDS ###

record(ai,"$(P)SIM:CARRIER_FREQ")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
}

alias("$(P)SIM:CARRIER_FREQ","$(P)SIM:CARRIER_FREQ:SP")

record(ai,"$(P)SIM:RF_LEVEL")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
}

alias("$(P)SIM:RF_LEVEL","$(P)SIM:RF_LEVEL:SP")

record(stringin,"$(P)SIM:ERROR")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
}

record(bi, "$(P)SIM:MOD:PULSE")
{
	field(ZNAM, "OFF")
	field(ONAM, "ON")
}

record(bi, "$(P)SIM:MOD:ENABLE")
{
	field(ZNAM, "OFF")
	field(ONAM, "ON")
	field(VAL, "1")
}

record(bi, "$(P)SIM:MOD:PULSE:CW")
{
	field(ZNAM, "OFF")
	field(ONAM, "ON")
}
